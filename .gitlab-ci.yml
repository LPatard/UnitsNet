stages:
  - build
  - deploy

variables:
  msbuild: 'C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\MSBuild\15.0\Bin\MSBuild.exe'

.runner-tags: &runner-tags
  tags:
    - windows
    - vs2017
    - powershell

Build:
  <<: *runner-tags
  stage: build
  script:
    - nuget restore "./UnitsNet.sln"
    - '& "$msbuild" "./UnitsNet.csproj" /t:build /p:Configuration=Release'

Publish on nuget:
  <<: *runner-tags
  stage: deploy
  only:
    - tags
  script:
    - nuget restore "./UnitsNet.sln"
    - '& dotnet msbuild "./UnitsNet.csproj" /t:pack /p:"Configuration=Release;PackageOutputPath=nugets;Version=$CI_COMMIT_TAG"'
    - nuget push (Resolve-Path -Relative "./UnitsNet/nugets/*.nupkg") -Source $BAGET_URL -ApiKey $BAGET_API_KEY
  artifacts:
    expire_in: 7 day
    paths:
      - nugets/
